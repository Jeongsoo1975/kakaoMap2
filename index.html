<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>AS 빈도수 지도 시각화</title>
    <!-- 카카오맵 SDK 로드 -->
    <script type="text/javascript" src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=18a3031306f7d4b7d1c63831b2f35310"></script>
    <style>
        /* 지도의 크기 설정 */
        #map {
            width: 100%;
            height: 100vh; /* 전체 화면 높이 */
        }
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            width: 100%;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <script>
        // 지도 초기화
        var mapContainer = document.getElementById('map'),
            mapOption = {
                center: new kakao.maps.LatLng(37.5665, 126.9780), // 서울 중심 좌표
                level: 7 // 확대 레벨
            };

        var map = new kakao.maps.Map(mapContainer, mapOption);

        // 외부 JSON 데이터 로드
        fetch('GeoDataResult2.json')
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                data.forEach(function(item, index) {
                    if(item.latitude && item.longitude){
                        // as_count이 숫자인지 확인
                        var asCount = Number(item.as_count);
                        if (isNaN(asCount) || asCount <= 0) {
                            console.warn(`Invalid as_count for item ${index}:`, item.as_count);
                            return;
                        }

                        var radius = Math.sqrt(asCount) * 300; // as_count에 비례한 반지름

                        var circle = new kakao.maps.Circle({
                            center: new kakao.maps.LatLng(item.latitude, item.longitude),
                            radius: radius,
                            strokeWeight: 2,
                            strokeColor: '#FF0000',
                            strokeOpacity: 0.8,
                            strokeStyle: 'solid',
                            fillColor: '#FF0000',
                            fillOpacity: 0.5
                        });
                        circle.setMap(map);

                        // 인포윈도우 생성
                        var infowindow = new kakao.maps.InfoWindow({
                            content: `<div style="padding:5px;">${item.name}: ${item.as_count}</div>`
                        });

                        // 원 클릭 시 인포윈도우 표시
                        kakao.maps.event.addListener(circle, 'click', function(mouseEvent) {
                            infowindow.setPosition(mouseEvent.latLng);
                            infowindow.open(map);
                        });
                    } else {
                        console.warn(`Item ${index} is missing latitude or longitude.`);
                    }
                });
            })
            .catch(error => console.error('Error fetching data:', error));
    </script>
</body>
</html>
